service:
  # service listen address and TLS settings
  address: "0.0.0.0"
  port: 8080
  db_path: "./database"
  tls:
    cert_file: ""
    key_file: ""

security:
  cors:
    allowed_origins:
      - "http://localhost:3000"
      - "http://127.0.0.1:3000"
  rate_limit:
    rps: 1000_0000
    burst: 2000_0000
  ip_whitelist:
    # - "127.0.0.1"
  api_keys:
    backend: ["sk_example"]
    frontend: ["pk_example"]
    admin: ["admin_example"]
  encryption:
    use: false
    fields: []
  kms:
    endpoint: "127.0.0.1:6820"
    data_dir: "./kms-data"
    binary: "/usr/local/bin/progressdb-kms"
    master_key_file: ""
    master_key_hex: ""

logging:
  level: "info"

retention:
  enabled: false
  cron: ""
  period: "24h"
  batch_size: 1000
  batch_sleep_ms: 0
  dry_run: false
  paused: false
  min_period: "1h"
  lock_ttl: 300s

ingest:
  processor:
    workers: 48                 # Double concurrency (more cores for higher throughput)
    max_batch_msgs: 1000        # Lower batch size for more frequent flush (better durability)
    flush_ms: 0                 # Flush immediately (as soon as possible) for highest durability
  queue:
    capacity: 131072            # Smaller queue, so less at risk in memory
    batch_size: 4096            # Smaller batch size for more frequent writing to WAL
    drain_poll_interval: 1ms    # Slightly slower polling, but avoids busy loop
    max_pooled_buffer_bytes: 512MB # Lower buffer; less memory left unflushed
    recover: true
    truncate_interval: 2s       # Truncate queue frequently for better durability
    wal:
      enabled: true              # WAL for durability - MUST be enabled!
      mode: batch
      max_file_size: 64MB         # Rotate WAL more often for integrity
      enable_batch: false        # Write every event as soon as possible
      batch_size: 1              # Write WAL every event (highest durability)
      batch_interval: 0          # No batching interval, flush now
      enable_compress: false     # Don't compress, optimize for speed/durability
      compress_min_bytes: 0
      compress_min_ratio: 0.95
      retention_bytes: 0
      retention_age: 0

telemetry:
  sample_rate: 0.001
  slow_threshold: 200ms

sensor:
  monitor:
    poll_interval: 500ms
    wal_high_bytes: 1GiB
    wal_low_bytes: 700MiB
    disk_high_pct: 80
    disk_low_pct: 60
    recovery_window: 5s
