version: '3.8'
services:
  prgkms:
    image: docker.io/progressdb/prgkms:latest
    restart: unless-stopped
    volumes:
      - ./kms-data:/var/lib/progressdb/kms
    command: ["/usr/local/bin/prgkms", "--config", "/var/lib/progressdb/kms/config.yaml"]
    networks:
      - progressdb_net

  progressdb:
    image: docker.io/progressdb/progressdb:latest
    restart: unless-stopped
    ports:
      - "8080:8080"
    environment:
      PROGRESSDB_USE_ENCRYPTION: "true"
      PROGRESSDB_KMS_MODE: "external"
      PROGRESSDB_KMS_ENDPOINT: "prgkms:6820"
      # server connects to the KMS over TCP at the endpoint in PROGRESSDB_KMS_ENDPOINT
    depends_on:
      - prgkms
    networks:
      - progressdb_net

networks:
  progressdb_net:
    driver: bridge
